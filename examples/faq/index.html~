<html>

<script type="text/javascript" charset="utf-8">
    var genie_debug = 1;
</script>

<script type="text/javascript" charset="utf-8" src='../../js/mootools.js'> </script>
<script type="text/javascript" charset="utf-8" src='../../genie.js'></script>
<link rel="stylesheet" href="style.css" type="text/css" media="screen" title="no title" charset="utf-8">

<body>
    <div class='title'><a href='index.html'>Genie FAQ</a>
        <div style='float:right;'>
            <input type='textfield' style='margin-top: 6px; font-size: 16px; width: 400px;'>
        </div>
    </div>
    <div id='genie-lamp'>Loading...</div>
</body>

<script type="text/javascript" charset="utf-8">
    var document_data = [];
    var env = null;

    function load_file(filename, callback) {
        new Request({
            url:filename,
            onSuccess: function(data) {
                callback(filename, data);
            },
            onFailure: function(data) {
                callback(filename, data.responseText);
            }
        }).send();
    }

    window.addEvent('domready', function() {
        env = new genie.Environment();
        
        load_file('data.txt', function(url, data) {
            document_data = JSON.parse(data);
            for(var i = 0; i < document_data['templates'].length; i++) {
                var filename = document_data['templates'][i];
                load_file(filename, function(fname, inner_d) {
                    var template = env.create_template(fname, inner_d);
                });
            }
        });

        setTimeout(function(){
            show_home();
        }, 2000);
    });

    function show_home() {
        console.log(env.template_dict);
        $('genie-lamp').innerHTML = env.render_template("templates/list_articles.html", {'articles':document_data['html_files']});
    }
    
    function show_article( file_name ) {
        $('genie-lamp').innerHTML = 'loading article...';
        load_file(file_name, function(fname, data) {
            var d = document.createElement('div');
            d.innerHTML = data;
            var article = {
                    'title':$(d).getChildren('.title')[0].innerHTML,
                    'content':$(d).getChildren('.content')[0].innerHTML
                };
            var content = env.render_template("templates/view_article.html", {'article':article});
            $('genie-lamp').innerHTML = content;
        });
    }
    
    function search_for( content ) {
        for( var i = 0; i < document_data['html_files'].length; i++ ) {
            var filename = document_data['templates'][i];
                load_file(filename, function(fname, data) {
            });
        }
    }
</script>


</html>